--- ldap_user/src/Processor/DrupalUserProcessor.php
+++ ldap_user/src/Processor/DrupalUserProcessor.php
@@ -10,6 +10,7 @@ use Drupal\Core\Extension\ModuleHandler;
 use Drupal\Core\Field\FieldItemListInterface;
 use Drupal\Core\File\FileSystemInterface;
 use Drupal\Core\Messenger\MessengerInterface;
+use Drupal\Core\Password\DefaultPasswordGenerator;
 use Drupal\Core\Session\AccountInterface;
 use Drupal\Core\StringTranslation\StringTranslationTrait;
 use Drupal\externalauth\Authmap;
@@ -201,6 +209,8 @@ class DrupalUserProcessor implements LdapUserAttributesInterface {
    *   Field Provider.
    * @param \Drupal\Core\Messenger\MessengerInterface $messenger
    *   Messenger.
+   * @param \Drupal\Core\Password\DefaultPasswordGenerator $passwordGenerator
+   *   Password Generator.
    */
   public function __construct(
     LoggerInterface $logger,
@@ -216,7 +226,8 @@ class DrupalUserProcessor implements LdapUserAttributesInterface {
     LdapUserManager $ldap_user_manager,
     EventDispatcherInterface $event_dispatcher,
     FieldProvider $field_provider,
-    MessengerInterface $messenger
+    MessengerInterface $messenger,
+    DefaultPasswordGenerator $passwordGenerator
     ) {
     $this->logger = $logger;
     $this->config = $config_factory->get('ldap_user.settings');
@@ -233,6 +244,7 @@ class DrupalUserProcessor implements LdapUserAttributesInterface {
     $this->eventDispatcher = $event_dispatcher;
     $this->fieldProvider = $field_provider;
     $this->messenger = $messenger;
+    $this->passwordGenerator = $passwordGenerator;
   }
 
   /**
@@ -566,14 +578,22 @@ class DrupalUserProcessor implements LdapUserAttributesInterface {
 
     $fieldSettings = $field->getFieldDefinition()->getItemDefinition()->getSettings();
     $directory = $this->token->replace($fieldSettings['file_directory']);
-    $fullDirectoryPath = $fieldSettings['uri_scheme'] . '://' . $directory;
-    $realpath = $this->fileSystem->realpath($fullDirectoryPath);
+    $directory_path = $fieldSettings['uri_scheme'] . '://' . $directory;
+    $realpath = $this->fileSystem->realpath($directory_path);
 
     if ($realpath && !is_dir((string) $realpath)) {
-      $this->fileSystem->mkdir($fullDirectoryPath, NULL, TRUE);
+      $this->fileSystem->mkdir($directory_path, NULL, TRUE);
     }
 
-    $managed_file = file_save_data($ldapUserPicture, $fullDirectoryPath . '/' . $fileName . '.' . $extension);
+    $managed_file_path = $directory_path . '/' . $fileName . '.' . $extension;
+    if (version_compare(\Drupal::VERSION, '9.3', '>=')) {
+      /** @var \Drupal\file\FileRepositoryInterface $file_repository */
+      $file_repository = \Drupal::service('file.repository');
+      $managed_file = $file_repository->writeData($ldapUserPicture, $managed_file_path);
+    }
+    else {
+      $managed_file = file_save_data($ldapUserPicture, $managed_file_path);
+    }
 
     $validators = [
       'file_validate_is_image' => [],
@@ -701,7 +721,7 @@ class DrupalUserProcessor implements LdapUserAttributesInterface {
     if (!$this->account->getPassword()) {
       if (version_compare(\Drupal::VERSION, '9.1', '>=')) {
         // phpcs:ignore
-        $this->account->set('pass', \Drupal::service('password_generator')->generate(20));
+        $this->account->set('pass', $this->passwordGenerator->generate(20));
       }
       else {
         $this->account->set('pass', user_password(20));
